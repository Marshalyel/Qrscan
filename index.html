<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Scanner Always‚ÄëOn</title>
  <!-- 1) Load library dulu -->
  <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
  <style>
    #reader { width: 400px; margin: 40px auto; }
    #log { text-align: center; margin-top: 20px; font-family: sans-serif; }
  </style>
</head>
<body>
  <h2 align="center">QR Scanner Always‚ÄëOn</h2>
  <div id="reader"></div>
  <div id="log">Initializing‚Ä¶</div>

  <script>
    let html5QrcodeScanner;

    // Callback sukses
    function onScanSuccess(decodedText) {
      const now = new Date().toLocaleString();
      document.getElementById('log').innerText = `‚úÖ [${now}] ${decodedText}`;

      html5QrcodeScanner.stop()
        .then(() => setTimeout(startScanner, 2000))
        .catch(console.error);
    }

    // Mulai scanner
    function startScanner() {
      document.getElementById('log').innerText = 'üîç Scan QR sekarang‚Ä¶';
      html5QrcodeScanner = new Html5Qrcode('reader');
      html5QrcodeScanner.start(
        { facingMode: 'environment' },
        { fps: 10, qrbox: 250 },
        onScanSuccess
      ).catch(err => {
        console.error('start() error:', err);
        document.getElementById('log').innerText = `‚ùå start() error: ${err.name}`;
      });
    }

    // Run after page load
    window.addEventListener('load', () => {
      // Pastikan Html5Qrcode sudah tersedia
      if (typeof Html5Qrcode === 'undefined') {
        document.getElementById('log').innerText = '‚ùå Library html5‚Äëqrcode gagal dimuat.';
        console.error('Html5Qrcode is not defined');
        return;
      }
      startScanner();
    });
  </script>
</body>
</html>
